(self["webpackChunkideao"]=self["webpackChunkideao"]||[]).push([[373],{7068:(e,t,i)=>{i(979),i(6105),i(2396),i(7070),i(323),window.Whammy=function(){function e(e,i){var a=t(e),n=3e4,r=[{id:440786851,data:[{data:1,id:17030},{data:1,id:17143},{data:4,id:17138},{data:8,id:17139},{data:"webm",id:17026},{data:2,id:17031},{data:2,id:17029}]},{id:408125543,data:[{id:357149030,data:[{data:1e6,id:2807729},{data:"whammy",id:19840},{data:"whammy",id:22337},{data:g(a.duration),id:17545}]},{id:374648427,data:[{id:174,data:[{data:1,id:215},{data:1,id:29637},{data:0,id:156},{data:"und",id:2274716},{data:"V_VP8",id:134},{data:"VP8",id:2459272},{data:1,id:131},{id:224,data:[{data:a.width,id:176},{data:a.height,id:186}]}]}]},{id:475249515,data:[]}]}],l=r[1],u=l.data[2],d=0,c=0;while(d<e.length){var m={id:187,data:[{data:Math.round(c),id:179},{id:183,data:[{data:1,id:247},{data:0,size:8,id:241}]}]};u.data.push(m);var h=[],v=0;do{h.push(e[d]),v+=e[d].duration,d++}while(d<e.length&&v<n);var f=0,w={id:524531317,data:[{data:Math.round(c),id:231}].concat(h.map((function(e){var t=s({discardable:0,frame:e.data.slice(4),invisible:0,keyframe:1,lacing:0,trackNum:1,timecode:Math.round(f)});return f+=e.duration,{data:t,id:163}})))};l.data.push(w),c+=v}for(var p=0,b=0;b<l.data.length;b++){b>=3&&(u.data[b-3].data[1].data[1].data=p);var y=o([l.data[b]],i);p+=y.size||y.byteLength||y.length,2!=b&&(l.data[b]=y)}return o(r,i)}function t(e){for(var t=e[0].width,i=e[0].height,a=e[0].duration,n=1;n<e.length;n++){if(e[n].width!=t)throw"Frame "+(n+1)+" has a different width";if(e[n].height!=i)throw"Frame "+(n+1)+" has a different height";if(e[n].duration<0||e[n].duration>32767)throw"Frame "+(n+1)+" has a weird duration (must be between 0 and 32767)";a+=e[n].duration}return{duration:a,width:t,height:i}}function i(e){var t=[];while(e>0)t.push(255&e),e>>=8;return new Uint8Array(t.reverse())}function a(e,t){for(var i=new Uint8Array(t),a=t-1;a>=0;a--)i[a]=255&e,e>>=8;return i}function n(e){for(var t=new Uint8Array(e.length),i=0;i<e.length;i++)t[i]=e.charCodeAt(i);return t}function r(e){var t=[],i=e.length%8?new Array(9-e.length%8).join("0"):"";e=i+e;for(var a=0;a<e.length;a+=8)t.push(parseInt(e.substr(a,8),2));return new Uint8Array(t)}function o(e,t){for(var s=[],u=0;u<e.length;u++)if("id"in e[u]){var d=e[u].data;if("object"==typeof d&&(d=o(d,t)),"number"==typeof d&&(d="size"in e[u]?a(d,e[u].size):r(d.toString(2))),"string"==typeof d&&(d=n(d)),d.length);var c=d.size||d.byteLength||d.length,m=Math.ceil(Math.ceil(Math.log(c)/Math.log(2))/8),g=c.toString(2),h=new Array(7*m+7+1-g.length).join("0")+g,v=new Array(m).join("0")+"1"+h;s.push(i(e[u].id)),s.push(r(v)),s.push(d)}else s.push(e[u]);if(t){var f=l(s);return new Uint8Array(f)}return new Blob(s,{type:"video/webm"})}function l(e,t){null==t&&(t=[]);for(var i=0;i<e.length;i++)"object"==typeof e[i]?l(e[i],t):t.push(e[i]);return t}function s(e){var t=0;if(e.keyframe&&(t|=128),e.invisible&&(t|=8),e.lacing&&(t|=e.lacing<<1),e.discardable&&(t|=1),e.trackNum>127)throw"TrackNumber > 127 not supported";var i=[128|e.trackNum,e.timecode>>8,255&e.timecode,t].map((function(e){return String.fromCharCode(e)})).join("")+e.frame;return i}function u(e){for(var t,i,a,n=e.RIFF[0].WEBP[0],r=n.indexOf("¬ù*"),o=0,l=[];o<4;o++)l[o]=n.charCodeAt(r+3+o);return a=l[1]<<8|l[0],t=16383&a,a>>14,a=l[3]<<8|l[2],i=16383&a,a>>14,{width:t,height:i,data:n,riff:e}}function d(e,t){var i=parseInt(e.substr(t,4).split("").map((function(e){var t=e.charCodeAt(0).toString(2);return new Array(8-t.length+1).join("0")+t})).reverse().join(""),2);return i}function c(e){var t=14;while(t<e.length){var i=e.substr(t,4);t+=4;var a=d(e,t);switch(t+=4,i){case"VP8 ":case"VP8L":var n=e.substr(t-4,4),r=e.substr(t,a);return n+r;default:t+=a;break}}console.error("VP8X format error: missing VP8/VP8L chunk.")}function m(e){var t=0,i={};while(t<e.length){var a=e.substr(t,4);if(i[a]=i[a]||[],"RIFF"==a||"LIST"==a){var n=d(e,t+4),r=e.substr(t+4+4,n);t+=8+n,i[a].push(m(r))}else if("WEBP"==a){var o=e.substr(t+4,4);switch(o){case"VP8X":i[a].push(c(e.substr(t+8)));break;case"VP8 ":case"VP8L":i[a].push(e.substr(t+8));break;default:console.error('not supported webp version: "'+o+'"');break}t=e.length}else i[a].push(e.substr(t+4)),t=e.length}return i}function g(e){return[].slice.call(new Uint8Array(new Float64Array([e]).buffer),0).map((function(e){return String.fromCharCode(e)})).reverse().join("")}function h(e,t){this.frames=[],this.duration=1e3/e,this.quality=t||.8}return h.prototype.add=function(e,t){if("undefined"!=typeof t&&this.duration)throw"you can't pass a duration if the fps is set";if("undefined"==typeof t&&!this.duration)throw"if you don't have the fps set, you need to have durations here.";if(e.canvas&&(e=e.canvas),e.toDataURL)e=e.getContext("2d").getImageData(0,0,e.width,e.height);else if("string"!=typeof e)throw"frame must be a a HTMLCanvasElement, a CanvasRenderingContext2D or a DataURI formatted string";if("string"===typeof e&&!/^data:image\/webp;base64,/gi.test(e))throw"Input must be formatted properly as a base64 encoded DataURI of type image/webp";this.frames.push({image:e,duration:t||this.duration})},h.prototype.encodeFrames=function(e){if(this.frames[0].image instanceof ImageData){var t=this.frames,i=document.createElement("canvas"),a=i.getContext("2d");i.width=this.frames[0].image.width,i.height=this.frames[0].image.height;var n=function(r){console.log("encodeFrame",r);var o=t[r];a.putImageData(o.image,0,0),o.image=i.toDataURL("image/webp",this.quality),r<t.length-1?setTimeout((function(){n(r+1)}),1):e()}.bind(this);n(0)}else e()},h.prototype.compile=function(t,i){this.encodeFrames(function(){var a=new e(this.frames.map((function(e){var t=u(m(atob(e.image.slice(23))));return t.duration=e.duration,t})),t);i(a)}.bind(this))},{Video:h,fromImageArray:function(t,i,a){return e(t.map((function(e){var t=u(m(atob(e.slice(23))));return t.duration=1e3/i,t})),a)},toWebM:e}}()},2089:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>re});i(71);var a=i(3673),n=i(2323),r=i(8880);const o=e=>((0,a.dD)("data-v-1f333150"),e=e(),(0,a.Cn)(),e),l={class:"wrapper"},s=o((()=>(0,a._)("img",{class:"icon",src:"img/previous_50X50.svg"},null,-1))),u=[s],d=o((()=>(0,a._)("img",{class:"icon",src:"img/thumbnail_50X50.svg"},null,-1))),c=[d],m=o((()=>(0,a._)("img",{class:"icon",src:"img/finish_50X50.svg"},null,-1))),g=[m],h={key:0,class:(0,n.C_)({"viewer-main":!0})},v={class:"viewer",ref:"divViewer"},f=["src"],w={ref:"viewerCanvas",style:{display:"none"}},p={key:1,class:"viewer-preview"},b={key:1,class:"viewer-bottom"},y={class:"rotate"},k=o((()=>(0,a._)("img",{class:"rotation",src:"img/fps_45X45.svg"},null,-1))),_=o((()=>(0,a._)("img",{class:"rotation",src:"img/video-time_45X45.svg"},null,-1))),F={class:"video-time"},C={class:"zoomInOut"},V=o((()=>(0,a._)("img",{class:"zoom",src:"img/music-time_45X45.svg"},null,-1))),P={key:0,class:"filename"},U={key:2,class:"zoom",src:"img/music-time_45X45.svg"},D={key:3,class:"music-time"},x={ref:"musicAudio",src:""},I=o((()=>(0,a._)("img",{src:"img/esc_20X20.svg"},null,-1))),A=[I],H=o((()=>(0,a._)("div",{class:"img"},[(0,a._)("img",{src:"img/finish_110X110.svg"})],-1))),M=o((()=>(0,a._)("div",{class:"text"}," Would you like to create a film only and abandon all images? ",-1))),L=o((()=>(0,a._)("div",{class:"text-2"}," If you want to save all images, please back to thumbnail mode to save the images. ",-1))),R=(0,a.Uk)("YES"),q=[R],S=(0,a.Uk)("NO"),j=[S];function W(e,t,i,o,s,d){const m=(0,a.up)("combobox"),I=(0,a.up)("q-card-section"),R=(0,a.up)("q-card-actions"),S=(0,a.up)("q-card"),W=(0,a.up)("q-dialog"),Z=(0,a.Q2)("close-popup");return(0,a.wg)(),(0,a.iD)(a.HY,null,[(0,a._)("div",l,[(0,a._)("div",{class:"previous",onClick:t[0]||(t[0]=(...t)=>e.goBack&&e.goBack(...t))},u),(0,a._)("div",{class:"thumbnail",onClick:t[1]||(t[1]=(...t)=>e.goViewer&&e.goViewer(...t))},c),(0,a._)("div",{class:"full-screen",onClick:t[2]||(t[2]=t=>e.confirmCreateFilmDialog=!0)},g),e.isViewerMode?((0,a.wg)(),(0,a.iD)("div",h,[(0,a._)("div",v,[e.motionPhotos.length>0?(0,a.wy)(((0,a.wg)(),(0,a.iD)("img",{key:0,ref:"viewerImage",class:"viewerImage",src:e.motionPhotos[0].src,style:(0,n.j5)({height:1==e.angle.value||3==e.angle.value?"100%":"auto",width:1==e.angle.value||3==e.angle.value?"auto":"100%"})},null,12,f)),[[r.F8,!e.isPreview]]):(0,a.kq)("",!0),(0,a._)("canvas",w,null,512),e.isPreview?(0,a.kq)("",!0):((0,a.wg)(),(0,a.iD)("div",p,[(0,a._)("img",{src:"",onClick:t[3]||(t[3]=(...t)=>e.preview&&e.preview(...t))})])),(0,a.wy)((0,a._)("video",{ref:"viewerVideo",controls:"",style:(0,n.j5)({height:1==e.angle.value||3==e.angle.value?"100%":"auto",width:1==e.angle.value||3==e.angle.value?"auto":"100%",maxHeight:"calc(100vh - 200px)",maxWidth:"calc(100vw - 356px)",left:"0px",top:"0px"})},null,4),[[r.F8,e.isPreview]])],512)])):(0,a.kq)("",!0),e.isViewerMode?((0,a.wg)(),(0,a.iD)("div",b,[(0,a._)("div",y,[k,(0,a.Wm)(m,{options:e.angleList,"option-label":"label","option-value":"value",modelValue:e.angle,"onUpdate:modelValue":t[4]||(t[4]=t=>e.angle=t),class:"combobox"},null,8,["options","modelValue"]),_,(0,a._)("span",F,(0,n.zw)(e.videoTime),1)]),(0,a._)("div",C,[V,(0,a._)("div",{class:(0,n.C_)({radio:!0,selected:null!=e.musicFile}),onClick:t[5]||(t[5]=t=>e.musicFileUpload.click())},null,2),(0,a._)("input",{type:"file",class:"music-file",ref:"musicFileUpload",onChange:t[6]||(t[6]=(...t)=>e.handleFileUpload&&e.handleFileUpload(...t))},null,544),null!=e.musicFile?((0,a.wg)(),(0,a.iD)("span",P,(0,n.zw)(e.filename),1)):(0,a.kq)("",!0),null!=e.musicFile?((0,a.wg)(),(0,a.iD)("img",{key:1,class:"reset-file",src:"img/music-reset_25X25.svg",onClick:t[7]||(t[7]=t=>e.musicFileUpload.click())})):(0,a.kq)("",!0),null!=e.musicFile?((0,a.wg)(),(0,a.iD)("img",U)):(0,a.kq)("",!0),null!=e.musicFile?((0,a.wg)(),(0,a.iD)("span",D,(0,n.zw)(e.musicTime),1)):(0,a.kq)("",!0),(0,a._)("audio",x,null,512)])])):(0,a.kq)("",!0)]),(0,a.Wm)(W,{modelValue:e.confirmCreateFilmDialog,"onUpdate:modelValue":t[9]||(t[9]=t=>e.confirmCreateFilmDialog=t)},{default:(0,a.w5)((()=>[(0,a.Wm)(S,{class:"confirmCard"},{default:(0,a.w5)((()=>[(0,a.Wm)(I,{class:"close"},{default:(0,a.w5)((()=>[(0,a.wy)((0,a._)("div",null,A,512),[[Z]])])),_:1}),(0,a.Wm)(I,{class:"items-center text-center"},{default:(0,a.w5)((()=>[H,M,L])),_:1}),(0,a.Wm)(R,{align:"center",class:"button"},{default:(0,a.w5)((()=>[(0,a.wy)((0,a._)("div",{onClick:t[8]||(t[8]=t=>e.finish())},q,512),[[Z]]),(0,a.wy)((0,a._)("div",null,j,512),[[Z]])])),_:1})])),_:1})])),_:1},8,["modelValue"])],64)}i(979),i(6105),i(2396),i(7965),i(6016),i(5363);var Z=i(1959),X=i(3617),T=i(9582),z=i(8825),B=i(958),E=i(9166);i(7068);const O=(0,a.aZ)({name:"PageViewer",components:{combobox:E.Z},setup(){ffmpeg({arguments:["-version"],print:function(e){},printErr:function(e){},onExit:function(e){console.log("Process exited with code "+e)}});const e=(0,T.tv)(),t=(0,X.oR)(),{guidHelper:i}=((0,z.Z)(),(0,B.Z)()),n=(0,Z.iH)(!0),r=(0,Z.iH)(!1),o=(0,Z.iH)({label:"2",value:2}),l=(0,Z.iH)([]),s=(0,Z.iH)(),u=(0,Z.iH)(),d=(0,Z.iH)(),c=(0,Z.iH)({}),m=(0,Z.iH)(),g=(0,Z.iH)([]),h=(0,Z.iH)("00:00"),v=(0,Z.iH)("00:00"),f=(0,Z.iH)(),w=(0,Z.iH)(),p=(0,Z.iH)(""),b=(0,Z.iH)(),y=(0,Z.iH)(!1),k=(0,Z.Fl)((()=>t.getters["extension/motionPhotos"])),_=(0,Z.Fl)((()=>t.getters["extension/viewers"])),F=e=>t.dispatch("extension/setViewers",e),C=e=>t.dispatch("extension/deleteViewer",e),V=()=>t.dispatch("extension/deleteMotionPhotos");(0,a.YP)(o,(async e=>{e&&(U(e.value),r.value=!1)})),(0,a.wF)((()=>{l.value=[];for(let e=2;e<=29;e++)l.value.push({label:e.toString(),value:e})})),(0,a.bv)((async()=>{U(o.value.value),S(D)}));const P=()=>{e.go(-1)},U=e=>{let t=0,i=k.value.length,a=(i-t)/e,n=Math.floor(a/60),r=Math.floor(a%60);h.value=("0"+n).slice(-2)+":"+("0"+r).slice(-2)},D=()=>{if("image"===c.value.type&&n.value){let e=d.value.getContext("2d");const t=new Image;t.src=c.value.src,t.onload=()=>{d.value.width=t.width,d.value.height=t.height,e.drawImage(t,0,0,t.width,t.height),changeViewerCanvasStyle()}}else"video"===c.value.type&&n.value&&j(c.value.filename,void 0,(e=>{let t=new Blob([new Uint8Array(e)]);console.log(t),c.value.src=URL.createObjectURL(t)}))},x=e=>{g.value.splice(e,1)},I=()=>{g.value.push({value:""})};let A=[];const H=e=>{e&&A.push(e)};(0,a.Xn)((()=>{A=[]}));let M=null,L=10737418240,R=0,q=window.requestFileSystem||window.webkitRequestFileSystem;const S=e=>{navigator.webkitPersistentStorage.requestQuota(L,(function(t){R=t,q(window.PERSISTENT,t,(function(t){M=t,e()}),(function(e){console.log(e)}))}),(function(e){console.log(e)}))},j=(e,t="",i)=>{if("undefined"===typeof e)return;let a;a=""!=t?t:M.root,a.getFile(e,{},(t=>{t.file((t=>{let a=new FileReader;a.onload=e=>{i(e.srcElement.result)},e.endsWith(".webm")?a.readAsArrayBuffer(t):e.endsWith(".jpg")?a.readAsDataURL(t):a.readAsBinaryString(t)}),(e=>{console.log(e)}))}),(e=>{console.log(e)}))},W=e=>{let t=M.root;t.getFile(e,{create:!1},(function(e){e.remove((function(e){}),(e=>{console.log(e)}))}),(e=>{console.log(e)}))},O=async e=>{e.target.files.length>0&&(p.value=e.target.files[0].name,w.value=e.target.files[0],b.value.src=URL.createObjectURL(e.target.files[0]),b.value.oncanplaythrough=()=>{let e=Math.floor(b.value.duration/60),t=Math.floor(b.value.duration%60);v.value=("0"+e).slice(-2)+":"+("0"+t).slice(-2)},r.value=!1)},Q=async e=>new Promise(((t,i)=>{e.onload=function(){t({width:e.width,height:e.height})}})),N=async()=>{let e=new Whammy.Video(o.value.value);for(let t in k.value){let i=d.value.getContext("2d");const a=new Image;a.src=k.value[t].src,await Q(a),d.value.width=a.width,d.value.height=a.height,i.drawImage(a,0,0,a.width,a.height),e.add(i)}return new Promise(((t,i)=>{e.compile(!1,(e=>{t({src:URL.createObjectURL(e),blob:e})}))}))},Y=async()=>{u.value.src=(await N()).src,r.value=!0},G=async()=>{if(0==k.value.length)return void e.replace({path:"/viewer"});let t=await N(),a=K()+".webm",n=Object.assign([],_.value);n.push({id:i(),type:"video",mimeType:"video/webm",filename:a,src:t.src,createTime:new Date}),F(n),await J(a,t.blob,"video/webm");let r=_.value.filter((e=>!0===e.isStopMotion));for(let e in r)C(r[e]),W(r[e].filename);V(),e.replace({path:"/viewer"})},J=(e,t,i)=>new Promise(((a,n)=>{M.root.getFile(e,{create:!0},(function(e){e.createWriter((function(e){e.seek(e.length),e.onwriteend=function(e){a()};let n=new Blob([t],{type:i});e.write(n)}))}))})),K=()=>{let e=new Date,t=e.getFullYear(),i=("00"+(e.getMonth()+1)).slice(-2),a=("00"+e.getDate()).slice(-2),n=("00"+e.getHours()).slice(-2),r=("00"+e.getMinutes()).slice(-2),o=("00"+e.getSeconds()).slice(-2),l=("00"+e.getMilliseconds()).slice(-3),s=t+"-"+i+"-"+a+"_"+n+"-"+r+"-"+o+"-"+l;return s},$=()=>{e.push({path:"/viewer",query:{vm:0}})};return{motionPhotos:k,combobox:E.Z,isViewerMode:n,isPreview:r,viewer:c,angle:o,angleList:l,viewerImage:s,viewerVideo:u,viewerCanvas:d,divViewer:m,optionList:g,confirmCreateFilmDialog:y,goBack:P,cancelOption:x,addOption:I,setOptionRef:H,preview:Y,finish:G,videoTime:h,musicTime:v,musicFileUpload:f,musicFile:w,handleFileUpload:O,filename:p,musicAudio:b,goViewer:$}}});var Q=i(4260),N=i(4390),Y=i(151),G=i(5589),J=i(9367),K=i(3414),$=i(6114),ee=i(1206),te=i(677),ie=i(7518),ae=i.n(ie);const ne=(0,Q.Z)(O,[["render",W],["__scopeId","data-v-1f333150"]]),re=ne;ae()(O,"components",{QDialog:N.Z,QCard:Y.Z,QCardSection:G.Z,QCardActions:J.Z,QItem:K.Z,QBtn:$.Z,QInput:ee.Z}),ae()(O,"directives",{ClosePopup:te.Z})}}]);