(self["webpackChunkideao"]=self["webpackChunkideao"]||[]).push([[621],{7068:(e,i,a)=>{a(979),a(6105),a(2396),a(7070),a(323),window.Whammy=function(){function e(e,a){var t=i(e),n=3e4,o=[{id:440786851,data:[{data:1,id:17030},{data:1,id:17143},{data:4,id:17138},{data:8,id:17139},{data:"webm",id:17026},{data:2,id:17031},{data:2,id:17029}]},{id:408125543,data:[{id:357149030,data:[{data:1e6,id:2807729},{data:"whammy",id:19840},{data:"whammy",id:22337},{data:v(t.duration),id:17545}]},{id:374648427,data:[{id:174,data:[{data:1,id:215},{data:1,id:29637},{data:0,id:156},{data:"und",id:2274716},{data:"V_VP8",id:134},{data:"VP8",id:2459272},{data:1,id:131},{id:224,data:[{data:t.width,id:176},{data:t.height,id:186}]}]}]},{id:475249515,data:[]}]}],s=o[1],d=s.data[2],c=0,u=0;while(c<e.length){var m={id:187,data:[{data:Math.round(u),id:179},{id:183,data:[{data:1,id:247},{data:0,size:8,id:241}]}]};d.data.push(m);var h=[],f=0;do{h.push(e[c]),f+=e[c].duration,c++}while(c<e.length&&f<n);var g=0,w={id:524531317,data:[{data:Math.round(u),id:231}].concat(h.map((function(e){var i=r({discardable:0,frame:e.data.slice(4),invisible:0,keyframe:1,lacing:0,trackNum:1,timecode:Math.round(g)});return g+=e.duration,{data:i,id:163}})))};s.data.push(w),u+=f}for(var p=0,b=0;b<s.data.length;b++){b>=3&&(d.data[b-3].data[1].data[1].data=p);var y=l([s.data[b]],a);p+=y.size||y.byteLength||y.length,2!=b&&(s.data[b]=y)}return l(o,a)}function i(e){for(var i=e[0].width,a=e[0].height,t=e[0].duration,n=1;n<e.length;n++){if(e[n].width!=i)throw"Frame "+(n+1)+" has a different width";if(e[n].height!=a)throw"Frame "+(n+1)+" has a different height";if(e[n].duration<0||e[n].duration>32767)throw"Frame "+(n+1)+" has a weird duration (must be between 0 and 32767)";t+=e[n].duration}return{duration:t,width:i,height:a}}function a(e){var i=[];while(e>0)i.push(255&e),e>>=8;return new Uint8Array(i.reverse())}function t(e,i){for(var a=new Uint8Array(i),t=i-1;t>=0;t--)a[t]=255&e,e>>=8;return a}function n(e){for(var i=new Uint8Array(e.length),a=0;a<e.length;a++)i[a]=e.charCodeAt(a);return i}function o(e){var i=[],a=e.length%8?new Array(9-e.length%8).join("0"):"";e=a+e;for(var t=0;t<e.length;t+=8)i.push(parseInt(e.substr(t,8),2));return new Uint8Array(i)}function l(e,i){for(var r=[],d=0;d<e.length;d++)if("id"in e[d]){var c=e[d].data;if("object"==typeof c&&(c=l(c,i)),"number"==typeof c&&(c="size"in e[d]?t(c,e[d].size):o(c.toString(2))),"string"==typeof c&&(c=n(c)),c.length);var u=c.size||c.byteLength||c.length,m=Math.ceil(Math.ceil(Math.log(u)/Math.log(2))/8),v=u.toString(2),h=new Array(7*m+7+1-v.length).join("0")+v,f=new Array(m).join("0")+"1"+h;r.push(a(e[d].id)),r.push(o(f)),r.push(c)}else r.push(e[d]);if(i){var g=s(r);return new Uint8Array(g)}return new Blob(r,{type:"video/webm"})}function s(e,i){null==i&&(i=[]);for(var a=0;a<e.length;a++)"object"==typeof e[a]?s(e[a],i):i.push(e[a]);return i}function r(e){var i=0;if(e.keyframe&&(i|=128),e.invisible&&(i|=8),e.lacing&&(i|=e.lacing<<1),e.discardable&&(i|=1),e.trackNum>127)throw"TrackNumber > 127 not supported";var a=[128|e.trackNum,e.timecode>>8,255&e.timecode,i].map((function(e){return String.fromCharCode(e)})).join("")+e.frame;return a}function d(e){for(var i,a,t,n=e.RIFF[0].WEBP[0],o=n.indexOf("¬ù*"),l=0,s=[];l<4;l++)s[l]=n.charCodeAt(o+3+l);return t=s[1]<<8|s[0],i=16383&t,t>>14,t=s[3]<<8|s[2],a=16383&t,t>>14,{width:i,height:a,data:n,riff:e}}function c(e,i){var a=parseInt(e.substr(i,4).split("").map((function(e){var i=e.charCodeAt(0).toString(2);return new Array(8-i.length+1).join("0")+i})).reverse().join(""),2);return a}function u(e){var i=14;while(i<e.length){var a=e.substr(i,4);i+=4;var t=c(e,i);switch(i+=4,a){case"VP8 ":case"VP8L":var n=e.substr(i-4,4),o=e.substr(i,t);return n+o;default:i+=t;break}}console.error("VP8X format error: missing VP8/VP8L chunk.")}function m(e){var i=0,a={};while(i<e.length){var t=e.substr(i,4);if(a[t]=a[t]||[],"RIFF"==t||"LIST"==t){var n=c(e,i+4),o=e.substr(i+4+4,n);i+=8+n,a[t].push(m(o))}else if("WEBP"==t){var l=e.substr(i+4,4);switch(l){case"VP8X":a[t].push(u(e.substr(i+8)));break;case"VP8 ":case"VP8L":a[t].push(e.substr(i+8));break;default:console.error('not supported webp version: "'+l+'"');break}i=e.length}else a[t].push(e.substr(i+4)),i=e.length}return a}function v(e){return[].slice.call(new Uint8Array(new Float64Array([e]).buffer),0).map((function(e){return String.fromCharCode(e)})).reverse().join("")}function h(e,i){this.frames=[],this.duration=1e3/e,this.quality=i||.8}return h.prototype.add=function(e,i){if("undefined"!=typeof i&&this.duration)throw"you can't pass a duration if the fps is set";if("undefined"==typeof i&&!this.duration)throw"if you don't have the fps set, you need to have durations here.";if(e.canvas&&(e=e.canvas),e.toDataURL)e=e.getContext("2d").getImageData(0,0,e.width,e.height);else if("string"!=typeof e)throw"frame must be a a HTMLCanvasElement, a CanvasRenderingContext2D or a DataURI formatted string";if("string"===typeof e&&!/^data:image\/webp;base64,/gi.test(e))throw"Input must be formatted properly as a base64 encoded DataURI of type image/webp";this.frames.push({image:e,duration:i||this.duration})},h.prototype.encodeFrames=function(e){if(this.frames[0].image instanceof ImageData){var i=this.frames,a=document.createElement("canvas"),t=a.getContext("2d");a.width=this.frames[0].image.width,a.height=this.frames[0].image.height;var n=function(o){console.log("encodeFrame",o);var l=i[o];t.putImageData(l.image,0,0),l.image=a.toDataURL("image/webp",this.quality),o<i.length-1?setTimeout((function(){n(o+1)}),1):e()}.bind(this);n(0)}else e()},h.prototype.compile=function(i,a){this.encodeFrames(function(){var t=new e(this.frames.map((function(e){var i=d(m(atob(e.image.slice(23))));return i.duration=e.duration,i})),i);a(t)}.bind(this))},{Video:h,fromImageArray:function(i,a,t){return e(i.map((function(e){var i=d(m(atob(e.slice(23))));return i.duration=1e3/a,i})),t)},toWebM:e}}()},3130:(e,i,a)=>{"use strict";a.r(i),a.d(i,{default:()=>Fe});a(71);var t=a(3673),n=a(2323),o=a(8880);const l=e=>((0,t.dD)("data-v-8fd18af0"),e=e(),(0,t.Cn)(),e),s={class:"wrapper"},r=l((()=>(0,t._)("img",{class:"icon",src:"img/previous_50X50.svg"},null,-1))),d=[r],c=l((()=>(0,t._)("img",{class:"icon",src:"img/thumbnail_50X50.svg"},null,-1))),u=[c],m={key:0,class:"icon",src:"img/full-screen_50X50.svg"},v={key:1,class:"icon",src:"img/exit-full-screen_50X50.svg"},h={class:"viewer-wrapper"},f={class:"download"},g=l((()=>(0,t._)("div",{class:"download-img"},null,-1))),w=l((()=>(0,t._)("div",{class:"download-text"},"Download",-1))),p=(0,t.Uk)("Video"),b=(0,t.Uk)("Images"),y=(0,t.Uk)("Project"),_=l((()=>(0,t._)("img",{class:"icon",src:"img/Exit_50X50.svg"},null,-1))),k=l((()=>(0,t._)("div",{class:"exit-text"},"Exit",-1))),F=[_,k],C=l((()=>(0,t._)("img",{class:"icon",src:"img/finish_50X50.svg"},null,-1))),x=l((()=>(0,t._)("div",{class:"finish-text"},"Finish",-1))),V=[C,x],P={key:0,class:"viewer-body"},D=["src"],U={ref:"viewerCanvas",style:{display:"none"}},H={key:1,class:"viewer-preview"},I={ref:"viewerVideo",controls:""},M={class:"viewer-footer"},q={class:"fps"},A=l((()=>(0,t._)("img",{class:"icon",src:"img/fps_45X45.svg"},null,-1))),S=l((()=>(0,t._)("img",{class:"icon",src:"img/video-time_45X45.svg"},null,-1))),W={class:"video-time"},j={class:"text"},X={class:"music-time"},L=l((()=>(0,t._)("img",{class:"icon",src:"img/music_45X45.svg"},null,-1))),T={key:0,class:"filename"},Z={class:"text"},R={key:2,class:"icon music-time-img",src:"img/music-time_45X45.svg"},E={key:3,class:"music-time-text"},z={class:"text"},Q={ref:"musicAudio",src:""},B={class:"close"},G=l((()=>(0,t._)("img",{src:"img/esc_20X20.svg"},null,-1))),O=[G],N=l((()=>(0,t._)("div",{class:"img"},[(0,t._)("img",{src:"img/excalmation_50X50.svg"})],-1))),Y=l((()=>(0,t._)("div",{class:"text"}," Would you like to create a film only and abandon all images? ",-1))),J=l((()=>(0,t._)("div",{class:"text-2"}," If you want to save all images, please back to thumbnail mode to save the images. ",-1))),K={class:"button"},$=l((()=>(0,t._)("div",{class:"text"},"NO",-1))),ee=[$],ie=l((()=>(0,t._)("div",{class:"text"},"YES",-1))),ae=[ie];function te(e,i,a,l,r,c){const _=(0,t.up)("q-item-section"),k=(0,t.up)("q-item"),C=(0,t.up)("q-menu"),x=(0,t.up)("combobox"),G=(0,t.up)("q-card-section"),$=(0,t.up)("q-card-actions"),ie=(0,t.up)("q-card"),te=(0,t.up)("q-dialog"),ne=(0,t.Q2)("close-popup");return(0,t.wg)(),(0,t.iD)(t.HY,null,[(0,t._)("div",s,[(0,t._)("div",{class:"previous",onClick:i[0]||(i[0]=(...i)=>e.onGoBack&&e.onGoBack(...i))},d),(0,t._)("div",{class:"thumbnail",onClick:i[1]||(i[1]=(...i)=>e.onGoViewer&&e.onGoViewer(...i))},u),(0,t._)("div",{class:"full-screen",onClick:i[2]||(i[2]=i=>{e.isViewerMode&&(e.isFullScreen=!e.isFullScreen)})},[e.isFullScreen?(0,t.kq)("",!0):((0,t.wg)(),(0,t.iD)("img",m)),e.isFullScreen?((0,t.wg)(),(0,t.iD)("img",v)):(0,t.kq)("",!0)]),(0,t._)("div",h,[(0,t._)("div",{class:(0,n.C_)({"viewer-header":!0,"thumbnail-mode":!e.isViewerMode})},[(0,t._)("div",f,[g,w,(0,t.Wm)(C,{fit:"",anchor:"bottom middle",self:"top middle",offset:[0,20],style:{"border-radius":"10px"}},{default:(0,t.w5)((()=>[(0,t.Wm)(k,{clickable:""},{default:(0,t.w5)((()=>[(0,t.Wm)(_,{onClick:e.onDownloadVideo},{default:(0,t.w5)((()=>[p])),_:1},8,["onClick"])])),_:1}),(0,t.Wm)(k,{clickable:""},{default:(0,t.w5)((()=>[(0,t.Wm)(_,{onClick:e.onDownloadImages},{default:(0,t.w5)((()=>[b])),_:1},8,["onClick"])])),_:1}),(0,t.Wm)(k,{clickable:""},{default:(0,t.w5)((()=>[(0,t.Wm)(_,{onClick:e.onDownloadProject},{default:(0,t.w5)((()=>[y])),_:1},8,["onClick"])])),_:1})])),_:1})]),(0,t._)("div",{class:"exit",onClick:i[3]||(i[3]=i=>e.onExit())},F),(0,t._)("div",{class:"finish",onClick:i[4]||(i[4]=i=>e.confirmCreateFilmDialog=!0)},V)],2),e.isViewerMode?((0,t.wg)(),(0,t.iD)("div",P,[(0,t._)("div",{class:(0,n.C_)({"viewer-main":!0,"resolution-9_16":.5625==e.viewer.ratio,"full-screen-mode":e.isFullScreen})},[e.motionPhotos.length>0?(0,t.wy)(((0,t.wg)(),(0,t.iD)("img",{key:0,ref:"viewerImage",class:"viewerImage",src:e.motionPhotos[0].src},null,8,D)),[[o.F8,!e.isPreview]]):(0,t.kq)("",!0),(0,t._)("canvas",U,null,512),e.isPreview?(0,t.kq)("",!0):((0,t.wg)(),(0,t.iD)("div",H,[(0,t._)("img",{src:"img/video_preview_50X50.svg",onClick:i[5]||(i[5]=(...i)=>e.onPreview&&e.onPreview(...i))})])),(0,t.wy)((0,t._)("video",I,null,512),[[o.F8,e.isPreview]])],2)])):(0,t.kq)("",!0),(0,t._)("div",M,[(0,t._)("div",q,[A,(0,t.Wm)(x,{options:e.frameList,"option-label":"label","option-value":"value",modelValue:e.frame,"onUpdate:modelValue":i[6]||(i[6]=i=>e.frame=i),class:"combobox",style:{width:"45px",height:"14px"}},null,8,["options","modelValue"]),S,(0,t._)("span",W,[(0,t._)("div",j,(0,n.zw)(e.videoTime),1)])]),(0,t._)("div",X,[L,(0,t._)("div",{class:(0,n.C_)({radio:!0,selected:null!=e.musicFile}),onClick:i[7]||(i[7]=i=>e.musicFileUpload.click())},null,2),(0,t._)("input",{type:"file",class:"music-file",ref:"musicFileUpload",onChange:i[8]||(i[8]=(...i)=>e.onHandleFileUpload&&e.onHandleFileUpload(...i))},null,544),null!=e.musicFile?((0,t.wg)(),(0,t.iD)("div",T,[(0,t._)("div",Z,(0,n.zw)(e.filename),1)])):(0,t.kq)("",!0),null!=e.musicFile?((0,t.wg)(),(0,t.iD)("img",{key:1,class:"reset-file",src:"img/music-reset_25X25.svg",onClick:i[9]||(i[9]=i=>e.musicFileUpload.click())})):(0,t.kq)("",!0),null!=e.musicFile?((0,t.wg)(),(0,t.iD)("img",R)):(0,t.kq)("",!0),null!=e.musicFile?((0,t.wg)(),(0,t.iD)("div",E,[(0,t._)("div",z,(0,n.zw)(e.musicTime),1)])):(0,t.kq)("",!0),(0,t._)("audio",Q,null,512)])])])]),(0,t.Wm)(te,{modelValue:e.confirmCreateFilmDialog,"onUpdate:modelValue":i[11]||(i[11]=i=>e.confirmCreateFilmDialog=i)},{default:(0,t.w5)((()=>[(0,t.Wm)(ie,{class:"confirm-card"},{default:(0,t.w5)((()=>[(0,t.Wm)(G,{class:"body"},{default:(0,t.w5)((()=>[(0,t.wy)((0,t._)("div",B,O,512),[[ne]]),N,Y,J])),_:1}),(0,t.Wm)($,{class:"footer"},{default:(0,t.w5)((()=>[(0,t.wy)((0,t._)("div",K,ee,512),[[ne]]),(0,t.wy)((0,t._)("div",{class:"button",onClick:i[10]||(i[10]=i=>e.onFinish())},ae,512),[[ne]])])),_:1})])),_:1})])),_:1},8,["modelValue"])],64)}a(7965),a(2799),a(5363);var ne=a(1959),oe=a(3617),le=a(9582),se=a(8825),re=a(958),de=a(6449);a(7068);const ce=(0,t.aZ)({name:"PageViewer",components:{combobox:de.Z},setup(){const e=(0,le.tv)(),i=(0,oe.oR)(),{guidHelper:a,timestampHelper:n,initFileSystem:o,loadTheFile:l,saveFile:s,getUrlByFilename:r}=((0,se.Z)(),(0,re.Z)()),d=(0,ne.iH)(!1),c=(0,ne.iH)(!0),u=(0,ne.iH)(!1),m=(0,ne.iH)({label:"2",value:2}),v=(0,ne.iH)([]),h=((0,ne.iH)(),(0,ne.iH)()),f=(0,ne.iH)(),g=(0,ne.iH)({}),w=((0,ne.iH)(),(0,ne.iH)([]),(0,ne.iH)("00:00")),p=(0,ne.iH)("00:00"),b=(0,ne.iH)(),y=(0,ne.iH)(),_=(0,ne.iH)(""),k=(0,ne.iH)(),F=(0,ne.iH)(!1);let C=null;(0,t.YP)(m,(async e=>{e&&(M(e.value),u.value=!1)}));const x=(0,ne.Fl)((()=>i.getters["extension/motionPhotos"])),V=e=>i.dispatch("extension/setMotionPhoto",e),P=(0,ne.Fl)((()=>i.getters["extension/viewers"])),D=e=>i.dispatch("extension/setViewers",e),U=e=>i.dispatch("extension/deleteViewer",e),H=()=>i.dispatch("extension/deleteMotionPhotos");(0,t.wF)((()=>{v.value=[];for(let e=2;e<=29;e++)v.value.push({label:e.toString(),value:e})})),(0,t.bv)((async()=>{M(m.value.value),C=await o();for(let e in x.value){let i=await r(C,x.value[e].filename,x.value[e].mimeType),a=Object.assign({},x.value[e]);a.src=i,V(a)}x.value.length>0&&(g.value=x.value[0]),await q()}));const I=()=>{e.go(-1)},M=e=>{let i=0,a=x.value.length,t=(a-i)/e,n=Math.floor(t/60),o=Math.floor(t%60);w.value=("0"+n).slice(-2)+":"+("0"+o).slice(-2)},q=()=>{if("image"===g.value.type&&c.value){let e=f.value.getContext("2d");const i=new Image;i.src=g.value.src,i.onload=()=>{f.value.width=i.width,f.value.height=i.height,e.drawImage(i,0,0,i.width,i.height)}}else"video"===g.value.type&&c.value},A=async e=>{e.target.files.length>0&&(_.value=e.target.files[0].name,y.value=e.target.files[0],k.value.src=URL.createObjectURL(e.target.files[0]),k.value.oncanplaythrough=()=>{let e=Math.floor(k.value.duration/60),i=Math.floor(k.value.duration%60);p.value=("0"+e).slice(-2)+":"+("0"+i).slice(-2)},u.value=!1)},S=async e=>new Promise(((i,a)=>{e.onload=function(){i({width:e.width,height:e.height})}})),W=async()=>{let e=new Whammy.Video(m.value.value);for(let i in x.value){let a=f.value.getContext("2d");const t=new Image;t.src=x.value[i].src,await S(t),f.value.width=t.width,f.value.height=t.height,a.drawImage(t,0,0,t.width,t.height),e.add(a)}return new Promise(((i,a)=>{e.compile(!1,(e=>{i({src:URL.createObjectURL(e),blob:e})}))}))},j=async()=>{h.value.src=(await W()).src,u.value=!0},X=async()=>{if(0==x.value.length)return void e.replace({path:"/viewer"});let i=await W(),t=n()+".webm",o=Object.assign([],P.value);o.push({id:a(),type:"video",mimeType:"video/webm",filename:t,src:i.src,createTime:new Date}),D(o),await s(C,t,i.blob,"video/webm");let l=P.value.filter((e=>!0===e.isStopMotion));for(let e in l)U(l[e]),removeTheFile(C,l[e].filename);H(),e.replace({path:"/viewer"})},L=()=>{e.push({path:"/viewer",query:{vm:0}})},T=()=>{u.value=!1},Z=()=>{let e=n()+".webm";var i=document.createElement("a");i.download=e,i.href=h.value.src,i.click(),i.remove()},R=()=>{for(let i in x.value){var e=document.createElement("a");e.download=x.value[i].filename,e.href=x.value[i].src,e.click(),e.remove()}},E=()=>{Z(),R()};return{motionPhotos:x,viewer:g,viewerCanvas:f,viewerVideo:h,musicAudio:k,isFullScreen:d,confirmCreateFilmDialog:F,isViewerMode:c,isPreview:u,frame:m,frameList:v,videoTime:w,musicFile:y,filename:_,musicTime:p,musicFileUpload:b,onGoBack:I,onGoViewer:L,onFinish:X,onPreview:j,onHandleFileUpload:A,onExit:T,onDownloadVideo:Z,onDownloadImages:R,onDownloadProject:E}}});var ue=a(4260),me=a(6335),ve=a(3414),he=a(2035),fe=a(4390),ge=a(151),we=a(5589),pe=a(9367),be=a(677),ye=a(7518),_e=a.n(ye);const ke=(0,ue.Z)(ce,[["render",te],["__scopeId","data-v-8fd18af0"]]),Fe=ke;_e()(ce,"components",{QMenu:me.Z,QItem:ve.Z,QItemSection:he.Z,QDialog:fe.Z,QCard:ge.Z,QCardSection:we.Z,QCardActions:pe.Z}),_e()(ce,"directives",{ClosePopup:be.Z})}}]);